{% extends 'layout.html' %}

{% block title %}
    <title>Statistiques</title>
{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1>Statistiques des Produits</h1>
    <hr>

    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white">
                    Moyennes par Catégorie
                </div>
                <div class="card-body">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Catégorie</th>
                                <th>Nombre de produits</th>
                                <th>Prix moyen</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for ligne in repartition %}
                            <tr>
                                <td>{{ ligne.libelle }}</td>
                                <td>{{ ligne.nombre }}</td>
                                <td class="badge rounded-pill" style="background-color: #198754; margin-top: 5px; margin-left: 5px;">
                                    {% if ligne.prix_moyen %}
                                        {{ ligne.prix_moyen | round(2) }} €
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    Top 5 des produits les plus chers
                </div>
                <div class="card-body">
                    <ul class="list-group">
                        {% for produit in top_produits %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            {{ produit.libelle_produit }}
                            <span class="badge bg-primary rounded-pill">{{ produit.prix_produit }} €</span>
                        </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>

    <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-warning text-dark">
                    <strong>Répartition par Période de Récolte</strong>
                </div>
                <div class="card-body">
                    <div class="table table-bordered">
                        <table class="table table-sm table-borderless">
                            <thead>
                                <tr class="border-bottom">
                                    <th>Période déclarée</th>
                                    <th class="text-end">Variétés à récolter</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for ligne in stats_periodes %}
                                <tr>
                                    <td class="fw-bold">{{ ligne.periode }}</td>
                                    <td class="badge rounded-pill" style="background-color: #ffc107; margin-left: 55%;">{{ ligne.nbr_produits }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
        </div>
    </div>

    <div class="mt-3">
        <a href="/produit/show" class="btn btn-secondary">Retour à la liste</a>
    </div>
</div>

{% endblock %}